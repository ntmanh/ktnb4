(function(c){if(typeof c.fn.btnAddRow=="undefined"){var d=[],b="ExpandableTable";function a(e,f){if(e){this.init(e,f)}}a.prototype.init=function(e,f){d.push(this);this.target=c(e).data(b,this);this.maxRow=f;this.seed=Math.round(Math.random()*10000);this.onAddRow=[];return this};a.prototype.live=function(){if(!this.goLive){var e=this;this.update();c(".addRow"+this.seed).live("click",function(){var f=e.addRow()});c(".delRow"+this.seed).live("click",function(){var f=c(this).closest("."+e.cloneClass),g=f.clone();f.hide().find("*").each(function(l,j){if(c(j).data("destroy")){}for(var h in c(j).data("destroy")){c(j).data("destroy")[h](j)}});f.remove();c(".addRow"+e.seed).attr("disabled",false);e.update();if(e.deleteCallBack&&c.isFunction(e.deleteCallBack)){e.deleteCallBack(g)}});c(".autoAdd"+this.seed).live("keyup",function(){if((this.nodeName.toLowerCase()=="textarea"&&c(this).html()!="")||(this.nodeName.toLowerCase()=="textarea"&&c(this).val()!="")||(this.nodeName.toLowerCase()=="input"&&c(this).val()!="")){e.addRow()}});this.goLive=true}return this};a.prototype.updateRowNumber=function(){var e=this;if(e.rowNumColumn){c("."+e.cloneClass,e.target).each(function(g,f){var h=g+1;c("."+e.rowNumColumn,c(f)).each(function(k,j){if(c(j).is(":text, textarea")){c(j).val(h)}else{c(j).text(h)}})})}return e};a.prototype.updateInputBoxName=function(){c("."+this.cloneClass,this.target).each(function(e,f){var g=e+1;c("input,textarea",c(f)).each(function(k,j){if(c(j).attr("name")!=""){var h=c(j).attr("name").replace(/\d+$/,"")+g;c(j).attr("name",h)}})});return this};a.prototype.updateInputBoxId=function(){var e=this;c("."+e.cloneClass,this.target).each(function(g,f){var h=g+1;c("input,textarea",c(f)).each(function(l,j){if(c(j).attr("id")!=""){var k=c(j).attr("id").replace(/\d+$/,"")+h;c(j).removeAttr("id").attr("id",k)}})});return this};a.prototype.updateOddRowCSS=function(){if(this.oddRowCSS){this.target.find("."+this.oddRowCSS).removeClass(this.oddRowCSS);this.target.find("tr:odd").addClass(this.oddRowCSS)}return this};a.prototype.updateEvenRowCSS=function(){if(this.evenRowCSS){this.target.find("."+this.evenRowCSS).removeClass(this.evenRowCSS);this.target.find("tr:even").addClass(this.evenRowCSS)}return this};a.prototype.updateRowCount=function(){if(this.displayRowCountTo){var e=c("."+this.cloneClass,this.target).size();c("."+this.displayRowCountTo,this.target).each(function(g,f){var h=f.nodeName.toLowerCase();if(h=="input"||h=="textarea"){c(f).val(e)}else{c(f).html(e)}})}return this};a.prototype.update=function(){var e=this;this.delRowButtons=c(".delRow"+this.seed,this.target);if(this.delRowButtons.size()==1){this.delRowButtons.hide()}else{if(this.autoAddRow){this.delRowButtons.not(":last").show()}else{this.delRowButtons.show()}}if(this.autoAddRow){this.target.find(".autoAdd"+this.seed).removeClass("autoAdd"+e.seed);this.target.find("."+e.cloneClass+":last").find("input,textarea").addClass("autoAdd"+this.seed)}if(this.inputBoxAutoNumber){this.updateInputBoxName();this.updateInputBoxId()}if(this.inputBoxAutoId){this.updateInputBoxId()}if(this.hideFirstOnly&&this.hideFirstOnly!=""){c("."+this.cloneClass).eq(0).find("."+this.hideFirstOnly).hide();c("."+this.cloneClass).not(":first").find("."+this.hideFirstOnly).show()}if(this.showFirstOnly&&this.showFirstOnly!=""){c("."+this.cloneClass).eq(0).find("."+this.showFirstOnly).show();c("."+this.cloneClass).not(":first").find("."+this.showFirstOnly).hide()}this.updateRowNumber().updateOddRowCSS().updateEvenRowCSS().updateRowCount();return this};a.prototype.addRow=function(){var e;if(!this.maxRow||(this.maxRow&&c("."+this.cloneClass).size()<this.maxRow)){this.delRowButtons.show();var f=c("."+this.cloneClass+":last",this.target);this.newRow=e=f.clone();e.find("input:text").val("");e.find("textarea").text("");if(this.autoAddRow){e.find("."+this.cloneClass).hide()}e.insertAfter(f);if(this.ignoreClass&&this.ignoreClass!=""){e.find("."+this.ignoreClass).each(function(){if(this.nodeName.toLowerCase()=="input"&&(c(this).attr("type").toLowerCase()=="text"||c(this).attr("type").toLowerCase()=="hidden")){c(this).val("")}else{if(this.nodeName.toLowerCase()=="td"){c(this).html(" ")}else{if(c(this).html()!=""){c(this).text("")}}}})}e.find("input:hidden").not("."+this.cloneClass).val("");if(this.hideFirstOnly&&this.hideFirstOnly!=""){e.find("."+this.hideFirstOnly).show()}if(this.showFirstOnly&&this.showFirstOnly!=""){e.find("."+this.hideFirstOnly).hide()}if(this.maxRow&&c("."+this.cloneClass).size()>=this.maxRow){c(".addRow"+this.seed).attr("disabled",true)}this.target.find("."+this.cloneClass+":first").closest("tr").find("*").each(function(j,h){if(c(this).data("init")){var l=e.find("*").eq(j),m=l[0];l.data("init",{});for(var g in c(this).data("init")){l.data("init")[g]=c(this).data("init")[g];l.data("init")[g](m)}}});this.update()}if(this.addCallBack&&c.isFunction(this.addCallBack)){this.addCallBack(e)}return e};c.fn.btnAddRow=c.fn.tableAutoAddRow=function(e,g){var h;if(typeof e=="object"){h=(g&&c.isFunction(g))?g:null}else{h=(e&&c.isFunction(e))?e:null}e=c.extend({maxRow:null,ignoreClass:null,rowNumColumn:null,autoAddRow:false,oddRowCSS:null,evenRowCSS:null,inputBoxAutoNumber:false,inputBoxAutoId:false,displayRowCountTo:null,maxRowAttr:null,hideFirstOnly:null,showFirstOnly:null,cloneClass:null,evenRowAttr:null,oddRowAttr:null,rowCountAttr:null,autoNumAttr:null,autoIdAttr:null},e);this.each(function(){var k,j,i;if(typeof e.cloneClass=="string"&&e.cloneClass!=""){if(c(this).closest("table").find("."+e.cloneClass).size()>0){k=c(this).closest("table");i=e.cloneClass}else{if(c(this).closest("."+e.cloneClass).size()>0){k=c(this).closest("."+e.cloneClass).closest("table");i=e.cloneClass}else{k=(this.nodeName.toLowerCase()=="table")?c(this):c(this).closest("table")}}}else{k=(this.nodeName.toLowerCase()=="table")?c(this):c(this).closest("table")}if(e.maxRowAttr&&typeof c(this).attr(e.maxRowAttr)!="undefined"){e.maxRow=c(this).attr(e.maxRowAttr)}if(e.oddRowAttr&&typeof c(this).attr(e.oddRowAttr)!="undefined"){e.oddRowCSS=c(this).attr(e.oddRowAttr)}if(e.evenRowAttr&&typeof c(this).attr(e.evenRowAttr)!="undefined"){e.evenRowCSS=c(this).attr(e.evenRowAttr)}if(e.rowCountAttr&&typeof c(this).attr(e.rowCountAttr)!="undefined"){e.displayRowCountTo=c(this).attr(e.rowCountAttr)}if(e.autoNumAttr&&typeof c(this).attr(e.autoNumAttr)!="undefined"){e.inputBoxAutoNumber=c(this).attr(e.autoNumAttr)}if(e.autoIdAttr&&typeof c(this).attr(e.autoIdAttr)!="undefined"){e.inputBoxAutoId=c(this).attr(e.autoIdAttr)}if(k.size()>0){if(typeof k.data(b)==="undefined"||k.data(b)===null){j=new a(k,e.maxRow);if(this.nodeName.toLowerCase()!="table"){c(this).addClass("addRow"+j.seed).data(b,j)}}else{if(this.nodeName.toLowerCase()!="table"){c(this).addClass("addRow"+k.data(b).seed).data(b,k.data(b))}}if(c(this).data(b)){j=c(this).data(b)}j.maxRow=e.maxRow;j.maxRow=e.maxRow;j.ignoreClass=e.ignoreClass;j.rowNumColumn=e.rowNumColumn;j.oddRowCSS=e.oddRowCSS;j.evenRowCSS=e.evenRowCSS;j.autoAddRow=e.autoAddRow;j.inputBoxAutoNumber=e.inputBoxAutoNumber;j.displayRowCountTo=e.displayRowCountTo;j.hideFirstOnly=e.hideFirstOnly;j.showFirstOnly=e.showFirstOnly;if(typeof i=="string"&&j.cloneClass!=i){j.cloneClass=i}else{j.cloneClass="cloneRow"+j.seed}j.updateRowCount();j.addCallBack=h}});for(var f=0;f<d.length;f++){if(!d[f].goLive){d[f].live()}}};c.fn.btnDelRow=function(e,g){var h;if(typeof e=="object"){h=(g&&c.isFunction(g))?g:null}else{h=(e&&c.isFunction(e))?e:null}e=c.extend({cloneClass:null},e);this.each(function(){var j,k,i;if(c(this).closest("."+e.cloneClass).size()>0){k=c(this).closest("."+e.cloneClass).closest("table");i=e.cloneClass}else{k=c(this).hide().closest("table")}if(k.size()>0){if(typeof k.data(b)==="undefined"||k.data(b)===null){j=new a(k);c(this).addClass("delRow"+j.seed).data(b,j)}else{c(this).addClass("delRow"+k.data(b).seed).data(b,k.data(b))}if(c(this).data(b)){j=c(this).data(b);j.deleteCallBack=h}if(!(typeof j.cloneClass=="string"&&j.cloneClass!="")){j.cloneClass="cloneRow"+j.seed;c(this).closest("tr").addClass("cloneRow"+j.seed)}else{if(typeof i=="string"){j.cloneClass=i}else{j.cloneClass="cloneRow"+j.seed;c(this).closest("tr").addClass("cloneRow"+j.seed)}}j.update()}});for(var f=0;f<d.length;f++){if(!d[f].goLive){d[f].live()}}}}})(jQuery);